from enum import Enum

debug = False

input = r""".|...\....
|.-.\.....
.....|-...
........|.
..........
.........\
..../.\\..
.-.-/..|..
.|....-|.\
..//.|...."""

input = r"""\....../..-......-.\.........\.......................-....../......../....................................|...
......\../../.....\-................../...........|................-../.............-./........|.|............
..-...-..../..............................-..............\.........-../...........................-.\.......\.
............./-..........|..............\/.................../........../............\.......|................
....|.....\.../...|..............\/..|-.................-..........\.\........................\...............
...........\...........-..|..../..\.-|........................-/.|/....../.........\.....|................/...
./....-|./.......|......-...-............-.......-......................................../....-............\.
....\...........|............-............-..\..|...|.........-..||.................\/...........|-|.|-.......
-............................-....................|........-...............\..................\...............
...............\......................-....../......|..||.|.-........................./......-............\...
.-...|........-.......|.........|....|.....-.........|..|............................./.../\...-........\.....
....................../...........-......-..--.|-...............-....................\......\.................
-....................-......-......./.......\|./......./........|...........|..................|..............
..-............../....................|.............-.......-.................-..................\......\.|...
....................\...............................................|.....\................../..-/............
...-.-/...\.//...|.............|........................\.............-|..|...........--..\........./...\.....
....................................................................\..........-......................-/......
..................................\......-.....-...........-.............-...........\...................|...-
......................\........|../..............-.........../......-...|......../.\......./..||..............
................................/......-................................./.........-......\./......|..........
........../....../....\.\|......-..............................\.....................--......|.............\..
..-.................-............../\............|.......................................\...|....\...........
./................\.|....\.........................../................|..............-....-..../..............
../...........\.\/./........\........-\...-/...........-............../........................|..............
......\.||.....................|..................\..............|........../......\/........../.....-........
..|/...........\.....|../.......\...........-.............|..............-........|...............-.....|.....
....................../.....-..|.......-...-...|.....................|./...\.........-........................
......................../........../\../.........-...\........./...............................|..\...........
.......................|\............./...|...............\/-...............|........................../..\...
..|....-.......\..................................\................................|......../.|..............-
........../...\.\........-......|.\.|.....................-............/..\..........|.../...-.............../
..\.-..............-............/..-..\..............\.........\....../...|........|........\....../..........
.....................|........................../..|....|.-.../........................-.\../-................
./..........-....|......|.|.................-....|........\......|............../.........................../.
....-..................................................................................-............|..-....//
......./...-.......................-..-.........-.............|........................../....................
.-...................-.......................................|.......-.................../..\...............\|
.........|.\......-.....\............./-....................../.........-..|....|......-......................
......./............./..........-......-......\...................................../............/..\.........
.....\......-................................/..........|.............\........\............/.................
......../..............\.........................|..........\......-............\.....|.....\....|...\|....-..
.....\.......\/................/...\.......|./......|............\./..........|/.....\\..\...\...|..-.........
..................|.....................-..........\....................../...../..............|......../..../
........./...........|....-..\.....................--..|......|...\|.......|...............|...-.||...........
..............-.....\...|...|./...|..........-......../......./..........-...../..|........../................
..|.../...................................|...................|......./..-.....-..............-...............
...-.........../..................-..........|.........................\..-................//\............/...
|...............\.........\.../.....................|.....-........................\...........-../.-......-..
........//..........-......................-....\...-.......-./.../......../........./...........|.|..........
...................\..../...../...|........--.....\../..........|...........................|.\...............
.\......................-........|\.....\....|.........\...............|.......\...-...|.................-....
.....................|......./..-........................../......-.........../........................../....
--.............\..........\-..../..-........\....-..........|./....|.\.................-..--.....\../.........
.......|........../|...................|.................\..-..........\../....|\.....|...-.......\..-........
........../|.|.....\....................|\..\...........-............./.......|.\.............................
...........|..........-..............|.....|-................/.........|..../.........................-.......
......-..........................|............-.......|/...-....--/................/..-.........|.............
......../.-.............|....\.../............................|.|.....|....../...............\............./..
........./.......\..........\...........\.....\..|....-...../........./........................./..|..........
...|...|........\.......-.......\..................\....................../............-...|.........\........
.........-...........|.........\....................../..........-.....\|.\...................\...............
.....|..........|................................../......................|............/.....|.........|..-|..
.../.......\....//....../....\....../..........\........................./....................\....-.../......
/.......\..\...........\................-|............/...-|.|...-..........\.................\.....|.../.....
.....-\.........|....../.......\.............-..........................\...........................\.........
.|.............|................\....\...........-................./............./............................
./...|\...........-\....................\..............-....|....|..........-.........|.../.....-.....\.\.....
....-...............|........-............./.....\....../..\.|.....|./.\......-...........\....../.\.......\..
..........\.....\................../......|.\..../.\..-......-.........-............/....\...................\
..\.........|.....\..........\............./...-....../....|.......-|\-............................../........
..|...\/........\..-\.|.\......./.....|.........-..|........|......................|..........................
............|..........................--.-....\..............-................................|...|..........
.-............../.....................|........../.................-....../.-...........................\-....
.-.........................-......|-./\.........................\.....|.................|......|..\.......\...
.....\...|....-......................................-...............\...........\..\...\..-|.....\...........
|...........|................|.........-............|....................|............-..-.............../....
.................../.|...........\.......\....|......-..|.....................\...................|..\.....\..
.|........-.../...|....../...|......|.|.|..-......\............../....|...........\|.......|.......\\.........
.......|.....-..-.-./....-/\.|./.............|.../......\...|/............/........./...-..........|\.\.......
..|.........-....\.........\.......\....-................|-..........................-.|............|.........
......-..\......|..\.../......\|..........|............../........../............/..\........................|
|/.|................../....|............../..........-........-............................|.\................
........|.....|/................../....\....../....../...................--..............\/..\................
.../-..........................|...-.........-.................\\.......-\.........\..|.....|.................
-./...-.....-....................../.../........./........-........../.........-...........\..................
.\../............|.\..........-.................................\.............../............../.........\./..
...-.....-......-......../.\...\................\...........|.................................................
...........-...//.....-/...-...........\|./......................\.........................|.-|...|...........
....../.....................-.......|........|-..................\............-.....................|.........
.....................\.\................../..|/......\........|.\..............|\..............\..-...........
....\................|\......................./.....-...............................-......../....-...........
...\....................-....|......|........-.\..|.......................\...\.|..............|............/.
...................-/.....................................-..\............-............-.............-....\...
.|....../.....\.....-.../......../..../..\.-...........\.../................|........\.................../....
.......|........./........................\.....-........-...............\....../....|../....\......./........
..........|.........../|......|......................-..............|./......................................\
....................../...../..............|.||............./......-......\...................................
\........|...-..................\./.................\.\.........-....\........../.../.-...\...................
....-..........|.......-......../................................./.../....-.............-..........\-........
..............................-.............\..\......................................-......../..............
......./.\|......../...-........|.........|................/.........................-....|...\.........|.....
......|..........-.......-............./........|..\...|.|..-.............................-.-...\.............
.||...........-.......\...../.....................-././..../.............-................|../.............--.
................\.-.....-\..........\.............\............/.........\.......-........\...................
......./...........\........\./.|..............|......-...........\................\...../.\...../..........|.
.-..-...|.....................-....../..............-.\|....\.......|..|....././.......|......................
./...-..................../................/....-/..\............/..................................\.........
....\.-..........\-......../............|...\.............|..................|.....\.................../......
...........-/..\..-................-....|............/...-.|.......-.|........./.....-/......./...............
..../...-.....\..............-..\.....\.|............./...|.\..................\...|.........\-./..|...../...."""

class DirectionWeAreHeadedIn(Enum):
    UP = 1
    DOWN = 2
    LEFT = 3
    RIGHT = 4

def debugprint(*args):
    if debug == True:
        print(*args)

def get_new_directions(mirror, direction_we_are_headed_in):
    if mirror == ".":
        return [direction_we_are_headed_in]
    elif mirror == "|":
        return [direction_we_are_headed_in] if direction_we_are_headed_in in [DirectionWeAreHeadedIn.UP, DirectionWeAreHeadedIn.DOWN] else [DirectionWeAreHeadedIn.UP, DirectionWeAreHeadedIn.DOWN]
    elif mirror == "-":
        return [direction_we_are_headed_in] if direction_we_are_headed_in in [DirectionWeAreHeadedIn.LEFT, DirectionWeAreHeadedIn.RIGHT] else [DirectionWeAreHeadedIn.LEFT, DirectionWeAreHeadedIn.RIGHT]
    elif mirror == "/":
        output_dict = {
            DirectionWeAreHeadedIn.UP: DirectionWeAreHeadedIn.RIGHT,
            DirectionWeAreHeadedIn.RIGHT: DirectionWeAreHeadedIn.UP,
            DirectionWeAreHeadedIn.DOWN: DirectionWeAreHeadedIn.LEFT,
            DirectionWeAreHeadedIn.LEFT: DirectionWeAreHeadedIn.DOWN
        }
        return [output_dict[direction_we_are_headed_in]]
    elif mirror == "\\":
        output_dict = {
            DirectionWeAreHeadedIn.UP: DirectionWeAreHeadedIn.LEFT,
            DirectionWeAreHeadedIn.RIGHT: DirectionWeAreHeadedIn.DOWN,
            DirectionWeAreHeadedIn.DOWN: DirectionWeAreHeadedIn.RIGHT,
            DirectionWeAreHeadedIn.LEFT: DirectionWeAreHeadedIn.UP
        }
        return [output_dict[direction_we_are_headed_in]]
    
    raise Exception("unknown mirror: " + mirror)

def get_total_energized_tiles(rows, num_cols, num_rows, first_ray):
    energized = [[False for x in range(num_cols)] for y in range(num_rows)]

    rays = []
    rays.append(first_ray)
    energized[first_ray["y"]][first_ray["x"]] = True

    energized_from_certain_direction = {}
    for direction in DirectionWeAreHeadedIn:
        energized_from_certain_direction[direction] = [[False for x in range(num_cols)] for y in range(num_rows)]


    while(len(rays) > 0):
        for ray in rays:
            x = ray["x"]
            y = ray["y"]
            direction = ray["direction"]

            if energized_from_certain_direction[direction][y][x] == True:
                rays.remove(ray)
                debugprint(f"{x}, {y} is already energized by beam going {direction}")
                continue

            energized[y][x] = True
            energized_from_certain_direction[direction][y][x] = True
            debugprint(f"{x}, {y} is now energized by beam going {direction} and this mirror is {rows[y][x]}")

            new_directions = get_new_directions(rows[y][x], direction)

            is_first_direction = True
            for new_direction in new_directions:
                new_x = x + 1 if new_direction == DirectionWeAreHeadedIn.RIGHT else x - 1 if new_direction == DirectionWeAreHeadedIn.LEFT else x
                new_y = y + 1 if new_direction == DirectionWeAreHeadedIn.DOWN else y - 1 if new_direction == DirectionWeAreHeadedIn.UP else y

                if new_x < 0 or new_x >= num_cols or new_y < 0 or new_y >= num_rows:
                    if is_first_direction:
                        is_first_direction = False
                        rays.remove(ray)
                        continue
                else:
                    if is_first_direction:
                        is_first_direction = False
                        ray["x"] = new_x
                        ray["y"] = new_y
                        ray["direction"] = new_direction
                    else:
                        debugprint(f"new ray at {new_x}, {new_y} going {new_direction}")
                        rays.append({"x": new_x, "y": new_y, "direction": new_direction})
        debugprint(f"Ray count is now {len(rays)}")

            
    total = 0
    for row in energized:
        for col in row:
            #print(".", end="") if col == False else print("x", end="")
            if col == True:
                total += 1
        #print()
    return total


def parse_input(input):
    rows = input.splitlines()

    # for idx, row in enumerate(rows):
    #     print(f"Row {idx}:")
    #     print(row)
    # return

    num_rows = len(rows)
    num_cols = len(rows[0])

    max_energized = 0
    first_ray_choices = []
    for direction in DirectionWeAreHeadedIn:
        if direction == DirectionWeAreHeadedIn.UP:
            for x in range(num_cols):
                first_ray_choices.append({"x": x, "y": num_rows - 1, "direction": direction})
        elif direction == DirectionWeAreHeadedIn.DOWN:
            for x in range(num_cols):
                first_ray_choices.append({"x": x, "y": 0, "direction": direction})
        elif direction == DirectionWeAreHeadedIn.RIGHT:
            for y in range(num_rows):
                first_ray_choices.append({"x": 0, "y": y, "direction": direction})
        elif direction == DirectionWeAreHeadedIn.LEFT:
            for y in range(num_rows):
                first_ray_choices.append({"x": num_cols - 1, "y": y, "direction": direction})
        else:
            raise Exception("unknown direction: " + direction)

    for first_ray in first_ray_choices:
        total_tiles_energized = get_total_energized_tiles(rows, num_cols, num_rows, first_ray)
        # print(f"Total tiles energized: {total_tiles_energized} for entering at {first_ray['x']}, {first_ray['y']} going {first_ray['direction']}")
        if total_tiles_energized > max_energized:
            max_energized = total_tiles_energized

    return max_energized


print(parse_input(input))
